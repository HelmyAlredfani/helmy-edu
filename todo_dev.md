# قائمة مهام تطوير نظام الردفاني

## المرحلة الأولى: تحليل النظام الحالي

- [x] مراجعة ملف `DATABASE.sql` لفهم مخطط قاعدة البيانات الحالي.
- [x] مراجعة ملفات PHP الرئيسية (مثل `DB.php`, `login.php`, `dashboard.php`) لفهم منطق العمل الحالي.
- [ ] مراجعة ملف `todo.md` السابق (إن وجد) للاطلاع على المهام المنجزة أو المخطط لها. (ملاحظة: تم العثور على ملف todo.md ولكنه عام جداً، سيتم الاعتماد على هذا الملف الجديد)
- [ ] مراجعة ملف `report.md` السابق (إن وجد) للاطلاع على أي تقارير أو ملاحظات سابقة. (ملاحظة: تم العثور على ملف report.md ولكنه عام جداً)
- [x] توثيق الهيكل الحالي للنظام وتحديد نقاط القوة والضعف فيما يتعلق بالمتطلبات الجديدة.

**ملخص تحليل النظام الحالي:**
*   **قاعدة البيانات:** بسيطة، تدعم مدرسة واحدة فقط. الجداول الموجودة: `users` (admin, teacher)، `subjects`، `teachers`، `students`، `grades`.
*   **منطق العمل (PHP):**
    *   `DB.php`: إعدادات اتصال بقاعدة بيانات MySQL.
    *   `login.php`: يسمح بدخول المستخدمين من جدول `users` بدور 'admin' فقط. لا يوجد نظام صلاحيات متقدم.
    *   `dashboard.php`: لوحة تحكم بسيطة للأدمن لإدارة المعلمين، المواد، الطلاب، والدرجات.
*   **نقاط الضعف الرئيسية:**
    *   لا يدعم تعدد المدارس.
    *   نظام صلاحيات محدود جداً (أدمن فقط فعلياً للوحة التحكم).
    *   لا يوجد دور لمدير المدرسة.
    *   لا يوجد ربط واضح للطلاب أو المعلمين بمدارس محددة (لأن النظام لمدرسة واحدة).
    *   لا توجد وظائف لحساب مجموع الدرجات، النسبة المئوية، التقدير، أو الترتيب.
*   **نقاط القوة:**
    *   بنية أساسية لإدارة الطلاب والمواد والدرجات موجودة، يمكن البناء عليها.

## المرحلة الثانية: تصميم التوسعة

- [x] **تصميم مخطط قاعدة بيانات جديد يدعم تعدد المدارس والأدوار الجديدة:**
    *   **جدول `schools` (جديد):**
        *   `id` (PK)
        *   `name` (اسم المدرسة)
        *   `address` (عنوان المدرسة - اختياري)
        *   `phone` (هاتف المدرسة - اختياري)
        *   (أي معلومات أخرى خاصة بالمدرسة)
    *   **تعديل جدول `users`:**
        *   `id` (PK)
        *   `username`
        *   `password`
        *   `role` (enum: 'system_admin', 'school_admin', 'teacher')
        *   `school_id` (FK references `schools.id`, nullable for 'system_admin')
        *   `full_name`
        *   `email` (اختياري)
    *   **تعديل جدول `teachers` (قد يتم دمجه مع `users` أو الإبقاء عليه مع ربط بـ `users` و `schools`):
        *   إذا تم الإبقاء عليه: `id` (PK), `user_id` (FK references `users.id`), `school_id` (FK references `schools.id`), `subject_specialization` (اختياري)
        *   (الخيار الأفضل هو دمج معلومات المعلم الأساسية في `users` مع دور 'teacher' وربطه بمدرسة)
    *   **تعديل جدول `students`:**
        *   `id` (PK)
        *   `name`
        *   `student_code`
        *   `school_id` (FK references `schools.id`)
        *   `class_id` (FK references `classes.id` - يتطلب جدول `classes` جديد)
        *   `parent_name`
        *   `phone`
        *   (أي معلومات أخرى)
    *   **جدول `classes` (جديد):**
        *   `id` (PK)
        *   `school_id` (FK references `schools.id`)
        *   `name` (اسم الصف/الفصل الدراسي، مثال: "الصف الأول أ", "السنة الثانية ب")
        *   `academic_year` (السنة الدراسية، مثال: "2024-2025")
    *   **تعديل جدول `subjects`:**
        *   `id` (PK)
        *   `name`
        *   `max_grade` (الدرجة العظمى للمادة - ضروري لحساب النسبة)
        *   `school_id` (FK references `schools.id`, إذا كانت المواد خاصة بكل مدرسة، أو يبقى عاماً إذا كانت المواد موحدة)
           (مبدئياً سيتم اعتبارها عامة ويمكن تخصيصها لاحقاً إذا لزم الأمر، أو ربطها بالصفوف الدراسية)
    *   **جدول `class_subjects` (جديد لربط المواد بالصفوف وتعيين المعلمين):**
        *   `id` (PK)
        *   `class_id` (FK references `classes.id`)
        *   `subject_id` (FK references `subjects.id`)
        *   `teacher_id` (FK references `users.id` where role is 'teacher')
    *   **تعديل جدول `grades`:**
        *   `id` (PK)
        *   `student_id` (FK references `students.id`)
        *   `class_subject_id` (FK references `class_subjects.id` - يربط الدرجة بالمادة والمعلم والصف)
        *   `grade` (الدرجة المحصلة)
        *   `semester` (الفصل الدراسي أو فترة التقييم)
        *   `exam_type` (نوع الاختبار: شهري، فصلي، نهائي - اختياري)
- [x] **تصميم نظام الأدوار والصلاحيات:**
    *   **مدير النظام (`system_admin`):**
        *   إدارة المدارس (إضافة، تعديل، حذف).
        *   إدارة مدراء المدارس (إضافة، تعديل، حذف مستخدمين بدور `school_admin` وربطهم بالمدارس).
        *   عرض تقارير شاملة على مستوى النظام (اختياري).
    *   **مدير المدرسة (`school_admin`):**
        *   إدارة المعلمين داخل مدرسته (إضافة، تعديل، حذف مستخدمين بدور `teacher` وربطهم بمدرسته).
        *   إدارة الطلاب داخل مدرسته (إضافة، تعديل، حذف).
        *   إدارة الصفوف الدراسية (`classes`) داخل مدرسته.
        *   إدارة المواد الدراسية (`subjects`) المخصصة لمدرسته أو ربط المواد العامة بالصفوف (`class_subjects`).
        *   تعيين المعلمين للمواد في الصفوف.
        *   عرض تقارير الطلاب والصفوف داخل مدرسته.
        *   لا يمكنه رؤية أو تعديل بيانات مدارس أخرى.
    *   **المعلم (`teacher`):**
        *   إدخال وتعديل درجات الطلاب في المواد والصفوف المعينة له.
        *   عرض معلومات ودرجات طلابه.
        *   لا يمكنه رؤية أو تعديل بيانات خارج نطاق صلاحياته (مواد وصفوف أخرى، طلاب آخرين).
    *   **الطالب/ولي الأمر (واجهة البحث `search.php`):**
        *   البحث عن نتائج طالب معين باستخدام رمز الطالب وربما المدرسة/الصف.
        *   عرض الدرجات، المجموع، النسبة، التقدير، والترتيب.
- [x] **تصميم آلية حساب مجموع الدرجات، النسبة المئوية، التقدير، والترتيب:**
    *   **مجموع الدرجات:** يتم حسابه لكل طالب في فترة معينة (مثلاً: فصل دراسي) بجمع `grade` من جدول `grades` بعد فلترتها بالطالب والفترة.
    *   **النسبة المئوية:** (مجموع الدرجات المحصلة / مجموع الدرجات العظمى لجميع المواد المسجلة للطالب في تلك الفترة) * 100. يتطلب معرفة `max_grade` لكل مادة من جدول `subjects` (أو `class_subjects` إذا كانت الدرجة العظمى تختلف باختلاف الصف).
    *   **التقدير:** يتم تحديده بناءً على النسبة المئوية وفقاً لنطاقات محددة (مثال: 90-100% ممتاز، 80-89% جيد جداً، إلخ). يجب تحديد هذه النطاقات.
    *   **الترتيب:** يتم ترتيب الطلاب داخل الصف الدراسي الواحد (`class_id`) بناءً على النسبة المئوية أو مجموع الدرجات (يجب تحديد المعيار). يمكن أيضاً حساب ترتيب على مستوى المدرسة إذا لزم الأمر.

## المرحلة الثالثة: تنفيذ التعديلات

- [x] تعديل/إنشاء جداول قاعدة البيانات. (تم إنشاء DATABASE_new.sql)
- [x] تعديل/إنشاء ملفات PHP لإدارة المدارس. (تم إنشاء system_admin/dashboard.php و system_admin/manage_schools.php)
- [x] تعديل/إنشاء ملفات PHP لإدارة المستخدمين (مدراء، معلمين) والصلاحيات. (تم إنشاء login_new.php, functions.php, هياكل dashboards للأدوار، system_admin/manage_school_admins.php, school_admin/manage_teachers.php)
- [x] تعديل/إنشاء ملفات PHP لإدخال وإدارة درجات الطلاب. (تم إنشاء الدوال الأساسية في functions.php، وواجهات المعلمين لإدخال الدرجات ستكون ضمن manage_my_subjects_classes.php و enter_grades.php - تم إنشاء الهيكل الأولي لها)
- [x] تعديل/إنشاء ملفات PHP لعرض تقارير الطلاب (المجموع، النسبة، التقدير، الترتيب). (تم إنشاء الدوال الأساسية في functions.php، وواجهات التقارير ستكون ضمن view_school_reports.php و view_my_student_reports.php - تم إنشاء الهيكل الأولي لها، بالإضافة إلى search.php الذي سيتم تحديثه)
- [ ] تعديل الواجهات الأمامية (`styles.css` والملفات ذات الصلة) لتعكس التغييرات الجديدة. (تم إجراء تعديلات طفيفة لدعم الصفحات الجديدة، ولكن لم يتم إجراء إعادة تصميم شاملة للواجهة الأمامية)

## المرحلة الرابعة: الاختبار والتوثيق

- [x] اختبار وظائف إدارة المدارس.
- [x] اختبار نظام الأدوار والصلاحيات.
- [x] اختبار وظائف إدخال وعرض الدرجات والتقارير (الدوال الأساسية والواجهات الأولية).
- [x] التأكد من صحة حسابات المجموع والنسبة والتقدير والترتيب (الدوال الأساسية).
- [x] توثيق التغييرات التي تم إجراؤها وتحديث دليل المستخدم (إذا لزم الأمر). (تم التوثيق في هذا الملف وفي التقرير النهائي)
- [x] إعداد تقرير نهائي وملف النظام المحدث.
